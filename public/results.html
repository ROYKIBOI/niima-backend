<script>
  const email = localStorage.getItem("email");
  if (!email) {
    window.location.href = "index.html";
  }

  function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("email");
    window.location.href = "index.html";
  }

  fetch(`https://niima-backend.onrender.com/api/user/${email}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("studentName").textContent = `Welcome, ${data.name}`;
      document.getElementById("studentEmail").textContent = data.email;

      const container = document.getElementById("modules");
      ['module1', 'module2', 'module3'].forEach((mod, i) => {
        const m = data[mod];
        if (!m) return;

        const card = document.createElement("div");
        card.className = "bg-white shadow-md rounded-lg p-5 mb-6";

        card.innerHTML = `
          <h3 class="text-xl font-semibold mb-3">Module ${i + 1}</h3>
          <p class="mb-2">Mean Score: <strong>${m.mean}</strong></p>
          <p class="mb-4">Overall Grade: <strong>${m.grade}</strong></p>
          <table class="w-full text-left border">
            <thead>
              <tr class="bg-gray-200">
                <th class="py-2 px-3 border">Subject</th>
                <th class="py-2 px-3 border">Marks</th>
                <th class="py-2 px-3 border">Grade</th>
              </tr>
            </thead>
            <tbody>
              ${m.subjects.map(sub => `
                <tr>
                  <td class="py-2 px-3 border">${sub.title}</td>
                  <td class="py-2 px-3 border">${sub.marks}</td>
                  <td class="py-2 px-3 border">${sub.grade}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        `;

        container.appendChild(card);
      });
    })
    .catch(() => {
      alert("Failed to load student results.");
      window.location.href = "index.html";
    });
</script>
